<!DOCTYPE html>
<html lang="zh-CN"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--bootstrap css-->
    <link href="/vote/src/main/webapp/assets/bootstrap-3.3.7/css/bootstrap.min.css"
          th:href="@{/assets/bootstrap-3.3.7/css/bootstrap.min.css}" rel="stylesheet">
    <!-- share.css -->
    <link href="/vote/src/main/webapp/assets/overtrue-share.js/css/share.min.css"
          th:href="@{/assets/overtrue-share.js/css/share.min.css}" rel="stylesheet">
    <!--Semantic-UI CSS-->
    <link href="/vote/src/main/webapp/assets/Semantic-UI/semantic.min.css"
          th:href="@{/assets/Semantic-UI/semantic.min.css}" rel="stylesheet">
    <!--jquery ui css-->
    <link href="/vote/src/main/webapp/assets/jquery-ui-1.12.1/jquery-ui.min.css"
          th:href="@{/assets/jquery-ui-1.12.1/jquery-ui.min.css}" rel="stylesheet">

    <!--jquery js-->
    <script src="/vote/src/main/webapp/assets/jquery-3.2.1/jquery-3.2.1.min.js"
            th:src="@{/assets/jquery-3.2.1/jquery-3.2.1.min.js}"></script>
    <!--jquery.validate js-->
    <script src="/vote/src/main/webapp/assets/jquery-validation-1.17.0/jquery.validate.min.js"
            th:src="@{/assets/jquery-validation-1.17.0/jquery.validate.min.js}"></script>
    <script src="/vote/src/main/webapp/assets/jquery-validation-1.17.0/localization/messages_zh.min.js"
            th:src="@{/assets/jquery-validation-1.17.0/localization/messages_zh.min.js}"></script>

    <!--Semantic-UI js-->
    <script src="/vote/src/main/webapp/assets/Semantic-UI/semantic.min.js"
            th:src="@{/assets/Semantic-UI/semantic.min.js}"></script>
    <!--jquery ui js-->
    <script src="/vote/src/main/webapp/assets/jquery-ui-1.12.1/jquery-ui.min.js"
            th:src="@{/assets/jquery-ui-1.12.1/jquery-ui.min.js}"></script>
    <!--bootstrap js-->
    <script src="/vote/src/main/webapp/assets/bootstrap-3.3.7/js/bootstrap.min.js"
            th:src="@{/assets/bootstrap-3.3.7/js/bootstrap.min.js}"></script>


    <!-- share.js -->
    <script src="/vote/src/main/webapp/assets/overtrue-share.js/js/social-share.min.js"
            th:src="@{/assets/overtrue-share.js/js/social-share.min.js}"></script>
    <!--当你使用类名为 `social-share` 或者 `social-share` 时不需要手动初始化-->

    <style>
        .line-height-30{
            line-height: 30px;
        }
    </style>
</head>
<body>
<div class="container" style="padding-top: 50px">
    <div class="container navbar-fixed-top">
        <div class="alert text-center" role="alert" style="padding: 8px" id="submit-alert">超过投票数量限制！</div>
    </div>

    <div class="ui link four cards" id="option-cards">
        <div class="card" th:each="voteOption,indexStat : ${voteOptionList}">
            <div class="image" th:if="${!#strings.isEmpty(voteOption.getImageUrl())}">
                <img th:src="${voteOption.getImageUrl()}" th:alt="${voteOption.getTitle()}">
            </div>
            <div class="content">
                <div class="header" th:if="${#strings.isEmpty(voteOption.getExternalLink())}" >
                    <span th:text="${voteOption.getTitle()}"></span>
                </div>
                <div class="header" th:unless="${#strings.isEmpty(voteOption.getExternalLink())}">
                    <a th:text="${voteOption.getTitle()}" th:href="${voteOption.getExternalLink()}"></a>
                </div>
                <div class="description" th:if="${!#strings.isEmpty(voteOption.getSummary())}"
                     th:text="${voteOption.getSummary()}"></div>
            </div>
            <div class="extra content">
                <span class="line-height-30" ><i class="user icon"></i>75(50.3%)</span>
                <span class="right floated line-height-30">
                    <button class="ui button mini small red vote-button">
                        <i class="heart icon"></i>
                        <span>投票</span>
                    </button>
                    <input type="hidden" th:value="${voteOption.getId()}" id="optionId">
                </span>
            </div>
        </div>


        <div class="container text-center" th:if="${voteInfo.getChoiceMax() != 0}">
            <button type="button" class="ui button primary big" id="vote-submit">
                <i class="checkmark box icon"></i>投票
            </button>
        </div>
    </div>
</div>

<script type="text/javascript" th:inline="javascript">
    /*<![DATA[*/
        var choiceMin =/*[[${voteInfo.getChoiceMin()}]]*/ 0;
        var choiceMax =/*[[${voteInfo.getChoiceMax()}]]*/ 0;
    /*]]>*/
    var selected = 0;
    $().ready(function () {
        $('#submit-alert').hide();
    });

    $('.vote-button').click(function () {
        if($(this).hasClass("red")){
            if(choiceMax > 1 && selected >= choiceMax){
                $('#submit-alert').removeClass("alert-warning").addClass("alert-success").html("超出投票数量限制!").slideDown();
                window.setTimeout(function () {
                    $('#submit-alert').slideUp();
                },3000);
                return ;
            }
            if(choiceMax==1 && selected >= 1){
                $('#option-cards').find("div .vote-button").each(function () {
                    $(this).removeClass("green").addClass('red');
                    $(this).children("i").removeClass("checkmark").addClass("heart");
                    $(this).children("span").html("投票");
                });
            }
            selected++;
            $(this).removeClass("red").addClass('green');
            $(this).children("i").removeClass("heart").addClass("checkmark");
            $(this).children("span").html("已选择");
            $(this).attr("selected",true);
        }else{
            selected--;
            $(this).removeClass("green").addClass('red');
            $(this).children("i").removeClass("checkmark").addClass("heart");
            $(this).children("span").html("投票");
            $(this).attr("selected",false);
    }});


    $('#vote-submit').click(function () {
        //检查选择数量
        if(selected>choiceMax){
            $('#submit-alert').removeClass("alert-success").addClass("alert-warning").html("超出投票数量限制!").slideDown();
            window.setTimeout(function () {
                $('#submit-alert').slideUp();
            },3000);
        }
        if(selected<choiceMin){
            $('#submit-alert').removeClass("alert-success").addClass("alert-warning").html("不足最少投票数!").slideDown();
            window.setTimeout(function () {
                $('#submit-alert').slideUp();
            },3000);
        }
        var selectedList = new Array();
        $('#option-cards').find("button.vote-button").each(function (index) {
            if($(this).attr('selected')) {
                selectedList.push($(this).next().val());
            }
        });


    });

</script>
</body>

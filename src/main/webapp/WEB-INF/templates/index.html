<!DOCTYPE html>
<html lang="zh-CN" >
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="../resources/css/bootstrap.min.css" rel="stylesheet">

    <!--[if lt IE 9]>
    <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script src="../resources/js/jquery-3.2.1.min.js"></script>
    <script src="../resources/js/jquery.validate.min.js"></script>
    <script src="../resources/js/messages_zh.min.js"></script>
    <script src="../resources/js/bootstrap.min.js"></script>

    <title>首页</title>

    <style type="text/css">
        #login-form label.error{
            color:darkred
        }
        #reg-form label.error{
            color:darkred
        }
    </style>

</head>
<body>
<nav class="navbar  navbar-fixed-top" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
        </div>
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <li><a href="/">首页</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li data-toggle="modal" data-target="#signModal" id="signButton"><a href="#">登录</a></li>
                <li data-toggle="modal" data-target="#regModal" id="regButton"><a href="#">注册</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="modal fade" tabindex="-1" role="dialog" id="signModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h3 class="modal-title">登录</h3>
            </div>
            <div class="modal-body">
                <form class="form-horizontal" id="login-form">
                    <div class="form-group">
                        <label for="login-email" class="col-sm-2 control-label">邮箱</label>
                        <div class="col-sm-10">
                            <input type="email" class="form-control" id="login-email" name="login-email" placeholder="邮箱">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="login-password" class="col-sm-2 control-label">密码</label>
                        <div class="col-sm-10">
                            <input type="password" class="form-control" id="login-password" name="login-password" placeholder="密码">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="login-vcode" class="col-sm-2 control-label">验证码</label>
                        <div class="col-sm-4">
                            <input type="password" class="form-control" id="login-vcode" name="login-vcode" placeholder="验证码">
                        </div>
                        <a href="#" id="reg-new-vcode"><img src="/captcha/alphanumeric?code=1" alt="验证码" id="reg-vcode-img"></a>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" id="login-button">登录</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div class="modal fade" tabindex="-1" role="dialog" id="regModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h3 class="modal-title">注册</h3>
            </div>
            <div class="modal-body">
                <form class="form-horizontal" id="reg-form">
                    <div class="form-group">
                        <label for="reg-nick-name" class="col-sm-2 control-label">昵称</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="reg-nick-name" name="reg-nick-name" placeholder="昵称" >
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="reg-email" class="col-sm-2 control-label">邮箱</label>
                        <div class="col-sm-10">
                            <input type="email" class="form-control" id="reg-email" name="reg-email" placeholder="邮箱">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="reg-password" class="col-sm-2 control-label">密码</label>
                        <div class="col-sm-10">
                            <input type="password" class="form-control" id="reg-password" name="reg-password" placeholder="密码">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="reg-confirm-password" class="col-sm-2 control-label">确认密码</label>
                        <div class="col-sm-10">
                            <input type="password" class="form-control" id="reg-confirm-password" name="reg-confirm-password" placeholder="再次输入密码">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="reg-vcode" class="col-sm-2 control-label">验证码</label>
                        <div class="col-sm-4">
                            <input type="password" class="form-control" id="reg-vcode"  name="reg-vcode" placeholder="验证码">
                        </div>
                        <a href="#" id="login-new-vcode"><img src="/captcha/alphanumeric?code=2" alt="验证码" id="login-vcode-img"></a>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" id="reg-button">注册</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->



<script type="text/javascript">

    $().ready(function () {
        $("#login-form").validate({
            rules:{
                "login-email":{
                    required:true,
                    email:true
                },
                "login-password":{
                    required:true
                },
                "login-vcode":{
                    required:true,
                    rangelength:[4,4]
                }
            },
            messages:{
                "login-email":{
                    required:"请输入邮箱",
                    email:"邮箱地址不合法"
                },
                "login-password":{
                    required:"请输入密码"
                },
                "login-vcode":{
                    required:"请输入验证码",
                    rangelength:"请输入正确的验证码"
                }
            }
        });

        $("#reg-form").validate({
            rules:{
                "reg-nick-name":{
                    required:true
                },
                "reg-email":{
                    required:true
                },
                "reg-password":{
                    required:true
                },
                "reg-confirm-password":{
                    required:true,
                    equalTo:"#reg-password"
                },
                "reg-vcode":{
                    required:true
                }
            },
            messages:{
                "reg-nick-name":{
                    required:"请输入昵称"
                },
                "reg-email":{
                    required:"请输入邮箱"
                },
                "reg-password":{
                    required:"请输入密码"
                },
                "reg-confirm-password":{
                    required:"请再次输入密码",
                    equalTo:"两次输入密码不一致"
                },
                "reg-vcode":{
                    required:"请输入验证码"
                }
            }
        })
    });

    $("#reg-button").click(
        function () {
            if($("#reg-form").valid()){
                $("#reg-form").submit();
                var nickName = $("#reg-nick-name").val();
                var email = $("#reg-email").val();
                var password = $("#reg-password").val();
                var vcode = $("#reg-vcode").val();
                $.post("/user/register",{
                    nickName:nickName,
                    email:email,
                    password:password
                },function (data) {
                    alert(data);
                });
            }
        }
    );

    $("#login-button").click(
        function () {
            if($("#login-form").valid()){
                $("#login-form").submit();
                var email = $("#login-email").val();
                var password = $("#login-password").val();
                var vcode = $("#login-vcode").val();
                $.post("/user/login",{
                    email:email,
                    password:password,
                    vcode:vcode
                },function (data) {
                    alert(data);
                });
            }
        }
    );


    $("#login-new-vcode").click(
        function () {
            var randId = new Date().getTime();
            $("#login-vcode-img").attr("src","/captcha/alphanumeric?code="+randId);
        }
    )


    $("#reg-new-vcode").click(
        function () {
            var randId = new Date().getTime();
            $("#reg-vcode-img").attr("src","/captcha/alphanumeric?code="+randId);
        }
    )



</script>


</body>
</html>